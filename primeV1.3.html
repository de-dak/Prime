<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Prime Bottle Master</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        :root {
            --bg-light: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 50%, #fbc2eb 100%);
            --bg-dark: linear-gradient(135deg, #000428 0%, #004e92 100%);
            --text-light: #333;
            --text-dark: #eee;
            --container-light: rgba(255, 255, 255, 0.2);
            --container-dark: rgba(0, 0, 0, 0.4);
            --border-light: rgba(255, 255, 255, 0.3);
            --border-dark: rgba(255, 255, 255, 0.2);
            --nav-bg-light: rgba(255, 255, 255, 0.3);
            --nav-bg-dark: rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-light);
            color: var(--text-light);
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.5s ease;
        }

        body.dark-mode {
            background: var(--bg-dark);
            color: var(--text-dark);
        }
        
        #app-container {
            width: 100%;
            height: 100%;
            max-width: 450px;
            max-height: 900px;
            background: var(--container-light);
            border: 1px solid var(--border-light);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        body.dark-mode #app-container {
            background: var(--container-dark);
            border: 1px solid var(--border-dark);
        }

        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s;
            display: flex;
            flex-direction: column;
        }
        
        .page.active {
            opacity: 1;
            visibility: visible;
            z-index: 10;
        }
        
        .page-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 80px; /* Space for nav bar */
             -ms-overflow-style: none;  
            scrollbar-width: none;
        }
        .page-content::-webkit-scrollbar {
            display: none;
        }
        
        .hidden { display: none !important; }

        /* Welcome Screen */
        #welcome-page {
            justify-content: center;
            align-items: center;
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
                        url('https://images.unsplash.com/photo-1514933651103-005eec06c04b?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80') center/cover no-repeat;
            color: white;
            padding: 20px;
        }
        .welcome-content { text-align: center; }
        .welcome-content h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.5);
            background: linear-gradient(to right, #fdc830, #f37335);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .welcome-content p { font-size: 1.1rem; margin-bottom: 2rem; opacity: 0.9; }
        #play-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            font-size: 1.2rem; padding: 12px 30px; border-radius: 50px;
            cursor: pointer; transition: all 0.3s ease; font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); color: white;
        }
        #play-btn:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-3px); }
        .verse { margin-top: 2rem; font-style: italic; opacity: 0.8; font-size: 0.9rem; }

        /* Game Page Header */
        .game-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-light);
        }
        body.dark-mode .game-header { border-bottom: 1px solid var(--border-dark); }
        .coins-display {
            background: rgba(0, 0, 0, 0.3); padding: 8px 15px; border-radius: 50px;
            font-weight: 600; display: flex; align-items: center; gap: 5px; color: white;
        }
        .level-display { font-weight: 600; text-transform: capitalize; }
        
        /* Game Page Content */
        .level-header { text-align: center; margin-bottom: 15px; }
        .level-header h2 { font-size: 1.5rem; color: #ff6b6b; }
        body.dark-mode .level-header h2 { color: #ff9e9e; }
        .difficulty-level-selectors { display: flex; justify-content: space-around; align-items: center; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
        .difficulty-selector, .level-selector { display: flex; align-items: center; gap: 5px; }
        
        .game-board { margin: 20px 0; }
        .player-sequence {
            display: flex; justify-content: center; gap: 10px;
            margin-bottom: 20px; min-height: 160px; flex-wrap: wrap;
        }
        .slot {
            position: relative; width: 70px; height: 160px;
            background: linear-gradient(145deg, rgba(0,0,0,0.1), rgba(0,0,0,0.3)), #a98765;
            border-bottom: 10px solid #7c624b; border-radius: 5px;
            display: flex; justify-content: center; align-items: center;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3), 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease; cursor: pointer;
        }
        .slot-label {
            position: absolute; top: 0px; font-weight: bold; color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8); font-size: 1.1rem; z-index: 5;
        }
        .slot.selected { transform: scale(1.05); box-shadow: 0 0 15px rgba(255, 255, 255, 0.7); }
        .slot.correct { box-shadow: 0 0 15px 5px rgba(46, 204, 113, 0.9) !important; }
        .slot.incorrect { box-shadow: 0 0 15px 5px rgba(231, 76, 60, 0.9) !important; }

        .bottle {
            width: 100%; height: 100%; object-fit: cover;
             position: absolute; top:18px; z-index: 0;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4)); bottom: 5px;
        }
        .bottle-options {
            display: flex; justify-content: center; gap: 0px; margin-top: 15px;
            flex-wrap: wrap; padding: 5px; background: rgba(0,0,0,0.1); border-radius: 10px;
        }
        .bottle-option {
            width: 70px; height: 70px; cursor: pointer;
            transition: all 0.3s; filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }
        .bottle-option:hover { transform: translateY(-5px) scale(1.05); }

        .game-controls { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
        .game-stats { display: flex; justify-content: center; gap: 20px; margin: 15px 0; }
        .stat { background: var(--container-light); padding: 8px 15px; border-radius: 50px; font-weight: 600; display: flex; gap: 5px; }
        body.dark-mode .stat { background: var(--container-dark); }

        /* Generic Page Styles (Shop, Settings) */
        .page-header {
            padding: 15px 20px; text-align: center;
            border-bottom: 1px solid var(--border-light);
            font-size: 1.2rem; font-weight: 600;
        }
        body.dark-mode .page-header { border-bottom: 1px solid var(--border-dark); }
        .page-header h2 { color: #ff6b6b; }
        body.dark-mode .page-header h2 { color: #ff9e9e; }
        
        .shop-items { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; }
        .shop-item { background: var(--container-light); border-radius: 10px; padding: 15px; text-align: center; transition: all 0.3s; cursor: pointer; }
        body.dark-mode .shop-item { background: var(--container-dark); }
        .shop-item:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        .shop-item img { transform:scale(2,2); width: 80px; height: 120px; margin-top:5px; object-fit: contain; margin-bottom: 10px; }
        .shop-item h3 { font-size: 0.8rem; margin-bottom: 0px; }
        .shop-item-price { font-weight: bold; color: #f39c12; font-size: 0.9rem; }
        .shop-item.unlocked { border: 2px solid #2ecc71; }
        .shop-item.locked { opacity: 1; filter: grayscale(0); }

        .settings-options { display: flex; flex-direction: column; gap: 15px; }
        .settings-option label { display: flex; align-items: center; justify-content: space-between; cursor: pointer; padding: 15px; background: var(--container-light); border-radius: 10px; }
        body.dark-mode .settings-option label { background: var(--container-dark); }
        .switch { position: relative; display: inline-block; width: 40px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 22px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #2196F3; }
        input:checked + .slider:before { transform: translateX(18px); }

        /* Search Results */
        #search-results {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            background: var(--container-light);
            border-radius: 10px;
            padding: 10px;
        }
        body.dark-mode #search-results {
            background: var(--container-dark);
        }
        .search-result-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            transition: background 0.3s;
        }
        body.dark-mode .search-result-item {
            border-bottom: 1px solid var(--border-dark);
        }
        .search-result-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .search-result-item img {
            width: 40px;
            height: 60px;
            object-fit: contain;
            margin-right: 15px;
        }
        .search-result-info {
            flex-grow: 1;
        }
        .search-result-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .search-result-status {
            font-size: 0.8rem;
            color: #f39c12;
        }
        .search-result-item.owned .search-result-status {
            color: #2ecc71;
        }
        .search-result-select-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        body.dark-mode .search-result-select-btn {
            background: rgba(0, 0, 0, 0.2);
            color: var(--text-dark);
        }

        .settings-options { display: flex; flex-direction: column; gap: 15px; }
        .settings-option label { display: flex; align-items: center; justify-content: space-between; cursor: pointer; padding: 15px; background: var(--container-light); border-radius: 10px; }
        body.dark-mode .settings-option label { background: var(--container-dark); }
        .switch { position: relative; display: inline-block; width: 40px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 22px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #2196F3; }
        input:checked + .slider:before { transform: translateX(18px); }

        /* Shop Header Controls */
        .shop-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
            align-items: center;
        }
        
        #search-input {
            flex: 1;
            padding: 10px 15px;
            border-radius: 50px;
            border: 1px solid var(--border-light);
            background: var(--container-light);
            color: var(--text-light);
            font-family: 'Poppins', sans-serif;
        }
        
        body.dark-mode #search-input {
            background: var(--container-dark);
            border: 1px solid var(--border-dark);
            color: var(--text-dark);
        }
        
        #collection-btn {
            padding: 10px 15px;
            border-radius: 50px;
            border: none;
            background: var(--container-light);
            color: var(--text-light);
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            white-space: nowrap;
        }
        
        body.dark-mode #collection-btn {
            background: var(--container-dark);
            color: var(--text-dark);
        }
        
        #collection-btn.active {
            background: #2ecc71;
            color: white;
        }
        
        body.dark-mode #collection-btn.active {
            background: #27ae60;
        }

        /* Common UI Elements */
        button {
            background: rgba(255, 255, 255, 0.3); border: 1px solid var(--border-light);
            color: var(--text-light); padding: 10px 15px; border-radius: 50px; cursor: pointer;
            transition: all 0.3s; font-weight: 600; backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); border: none;
        }
        body.dark-mode button { background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border-dark); color: var(--text-dark); }
        button:hover { transform: translateY(-2px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        select {
            background: rgba(255, 255, 255, 0.3); border: 1px solid var(--border-light);
            color: var(--text-light); padding: 5px 10px; border-radius: 50px;
        }
        body.dark-mode select { background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border-dark); color: var(--text-dark); }
        
        .feedback {
            text-align: center; font-weight: 600; margin: 15px 0; padding: 10px;
            border-radius: 10px; transition: all 0.3s ease; min-height: 40px;
            display: flex; align-items: center; justify-content: center;
            background: var(--container-light); backdrop-filter: blur(5px); font-size: 0.9rem;
        }
        body.dark-mode .feedback { background: var(--container-dark); }
        .feedback.success { background:rgba(46, 204, 113, 0.5); }
        .feedback.warning { background: rgba(241, 196, 15, 0.5); }
        .feedback.error { background: rgba(231, 76, 60, 0.5); }
        .feedback.unlock { background: rgba(155, 89, 182, 0.5); animation: pulse 1.5s infinite; }
        
        /* Navigation */
        .nav-bar {
            position: absolute; bottom: 0; left: 0; right: 0;
            height: 70px;
            background: var(--nav-bg-light);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 20;
            border-top: 1px solid var(--border-light);
        }
        body.dark-mode .nav-bar { background: var(--nav-bg-dark); border-top: 1px solid var(--border-dark); }
        .nav-item {
            cursor: pointer; padding: 10px; border-radius: 10px;
            transition:  0.3s; opacity: 0.7;
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            color: var(--text-light);
        }
        body.dark-mode .nav-item { color: var(--text-dark); }
        .nav-item.active { opacity: 1; font-weight: 600; }
        .nav-item:hover { background: rgba(255, 255, 255, 0.2); }
        body.dark-mode .nav-item:hover { background: rgba(255, 255, 255, 0.1); }
        .nav-item svg { width: 24px; height: 24px; }
        .nav-item span { font-size: 0.7rem; }

        /* Animations */
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .confetti {
            position: absolute; width: 10px; height: 10px;
            background-color: #f00; animation: confettiFall 3s linear forwards;
            border-radius: 50%; top: 0;
        }
        @keyframes confettiFall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="app-container">
        <!-- Welcome Page -->
        <div id="welcome-page" class="page active">
            <div class="welcome-content">
                <h1>PRIME BOTTLE MASTER</h1>
                <p>Match the sequence to unlock all Prime flavors!</p>
                <button id="play-btn">PLAY NOW</button>
                <div class="verse">"I can do all things through Christ who strengthens me" - Philippians 4:13</div>
            </div>
        </div>

        <!-- Game Page -->
        <div id="game-page" class="page">
            <div class="game-header">
                <div class="coins-display">ðŸª™ <span id="coins">100</span></div>
                <div class="level-display">Easy 1</div>
            </div>
            <div class="page-content">
                <div class="level-header">
                    <h2>LEVEL <span id="level-number">1</span></h2>
                    <div class="difficulty-level-selectors">
                         <div class="difficulty-selector">
                            <span>Difficulty:</span>
                            <select id="difficulty-select">
                                <option value="easy">Easy</option>
                                <option value="medium">Medium</option>
                                <option value="hard">Hard</option>
                            </select>
                        </div>
                        <div class="level-selector">
                            <span>Level:</span>
                            <select id="level-select"></select>
                        </div>
                    </div>
                </div>
                <div class="game-board">
                    <div class="player-sequence" id="player-sequence"></div>
                    <div class="bottle-options" id="bottle-options"></div>
                </div>
                <div class="game-stats">
                    <div class="stat"><span>Moves:</span> <span id="moves">0</span></div>
                    <div class="stat"><span>Time:</span> <span id="timer">00:00</span></div>
                </div>
                <div class="feedback" id="feedback">Click a slot, then select a bottle!</div>
                <div class="game-controls">
                    <button id="start-btn">Start Game</button>
                    <button id="check-btn" class="hidden">Check</button>
                    <button id="new-game-btn">New Game</button>
                </div>
            </div>
        </div>

        <!-- Shop Page -->
        <div id="shop-page" class="page">
            <div class="page-header">
                <h2>PRIME BOTTLE SHOP</h2>
                <div class="shop-controls">
                    <input type="text" id="search-input" placeholder="Search bottles...">
                    <button id="collection-btn">Collection</button>
                </div>
            </div>
            <div class="page-content">
                <div id="search-results" class="hidden"></div>
                <div class="shop-items" id="shop-items"></div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings-page" class="page">
             <div class="page-header"><h2>GAME SETTINGS</h2></div>
             <div class="page-content">
                <div class="settings-options">
                    <div class="settings-option">
                        <label>
                            <span>Dark Mode</span>
                             <span class="switch">
                                <input type="checkbox" id="dark-mode-toggle">
                                <span class="slider"></span>
                            </span>
                        </label>
                    </div>
                    <div class="settings-option">
                        <label>
                             <span>Sound Effects</span>
                             <span class="switch">
                                <input type="checkbox" id="sound-toggle" checked>
                                <span class="slider"></span>
                            </span>
                        </label>
                    </div>
                    <div class="settings-option">
                        <label>
                           <span>Background Music</span>
                             <span class="switch">
                                <input type="checkbox" id="music-toggle" checked>
                                <span class="slider"></span>
                            </span>
                        </label>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button id="reset-game-btn">Reset Game Progress</button>
                </div>
            </div>
        </div>

        <!-- Navigation Bar -->
        <div class="nav-bar hidden" id="nav-bar">
            <div class="nav-item" data-page="game-page">
                 <svg fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                <span>Game</span>
            </div>
            <div class="nav-item" data-page="shop-page">
                <svg fill="currentColor" viewBox="0 0 20 20"><path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path></svg>
                <span>Shop</span>
            </div>
            <div class="nav-item" data-page="settings-page">
                 <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path></svg>
                <span>Settings</span>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const allBottles = [
                { id: 1, name: 'Ice Pop', image: 'https://drinkprime.com/cdn/shop/products/PrimeHydration_1serve_IcePop_0000_1200x.png?v=1656076690', price: 3500, unlocked:true },
                { id: 2, name: 'Tropical Punch', image: 'https://drinkprime.com/cdn/shop/products/PrimeHydration_1serve_tropicalpunch_0000_1200x.png?v=1656076860',price: 400, unlocked: true },
                { id: 3, name: 'Blue Raspberry', image: 'https://drinkprime.uk/cdn/shop/files/PrimeHydration_UK_1serve_500ml_BlueRaspberry_0000_2000x.png?v=1697126350', price: 1000, unlocked: false },  
                { id: 4, name: 'Lemon Lime', image: 'https://drinkprime.com/cdn/shop/products/PrimeHydration_1serve_lemonlime_0000_2000x.png?v=1656076731', price: 1500, unlocked: false }, 
                { id: 5, name: 'Lemonade', image: 'https://drinkprime.uk/cdn/shop/files/PrimeHydration_UK_1serve_500ml_Lemonade_0000_1_d6c1d01a-6c5c-4ee2-ba32-2cf5dc154a56_2000x.png?v=1732730278', price: 500, unlocked: true },
                { id: 6, name: 'Strawberry Banana', image: 'https://drinkprime.com/cdn/shop/files/SBHydrationFront_2000x.png?v=1708725252', price: 2000, unlocked: false },
                { id: 7, name: 'Future Freeze', image: 'https://drinkprime.com/cdn/shop/files/PrimeHydration_US_1serve_FutureFreeze_00000_2000x.png?v=1738603072', price: 1000, unlocked: false },
                { id: 8, name: 'X', image: 'https://drinkprime.com/cdn/shop/files/PrimeX_Web_ProductPage_Blue_Front_94b506ea-f8d6-439e-8764-19173ba4baa5_2000x.png?v=1717432079', price: 1500, unlocked: false },
                { id: 9, name: 'Meta Moon', image:'https://drinkprime.com/cdn/shop/products/Prime-Metamoon-ProductDetail-front_2000x.png?v=1662754165', price: 2000, unlocked: false },
                { id: 10, name: 'Collector Series', image: 'https://drinkprime.uk/cdn/shop/files/CollectorSeries_Web_DropBanner_PDP_Front_2000x2000_1f0e9322-27fa-4f8b-bcae-5d5f13810025_2000x.png?v=1748870763', price: 3000, unlocked: false },
                { id: 11, name: 'SourNova', image: 'https://drinkprime.com/cdn/shop/files/Sournova_Web_DropBanner_PDP_Front_2000x2000_ffba587e-02f2-491a-a375-5f5b3e7f2eb8_2000x.png?v=1744126206', price: 3500, unlocked: false },
                { id: 12, name: 'Orange Kream', image: 'https://drinkprime.com/cdn/shop/files/OrangeKream_Web_DropBanner_PDP_Front_2000x2000_8b5dd6e8-169d-4332-84ef-e4028707c470_2000x.png?v=1752250151', price: 4000, unlocked: false },
                { id: 13, name: 'Orange Ice', image: 'https://drinkprime.uk/cdn/shop/files/UK_ICE_Web_Orange_PDP_Front_2200x2200_afa0a64e-1ddc-4d03-b3d4-808679eafb22_2000x.png?v=1738946368', price: 5000, unlocked: false },
                { id: 14, name: 'Peso Pluma ', image: 'https://drinkprime.com/cdn/shop/files/Prime_hydration_1serve_16.9oz_US_PesoPluma_00000_2000x.png?v=1742393763',price: 400, unlocked: true },
                { id: 15, name: 'GlowBerry', image: 'https://drinkprime.com/cdn/shop/files/GB_Product_Page_-_Front_2000x.png?v=1722366864',price: 7000,unlocked: true },
                { id: 16, name: 'Berry Freeze', image: 'https://drinkprime.com/cdn/shop/files/Berry-Freeze-Front_1_2000x.png?v=1730302649', price: 1000, unlocked: false },
                { id: 17, name: 'Cherry Freeze', image: 'https://drinkprime.com/cdn/shop/files/Prime_hydration_1serve_16.9oz_US_CherryFreeze_Fortis_00000_2000x.png?v=1745589968', price: 1500, unlocked: false },
                { id: 18, name: 'Red Chill',image: 'https://drinkprime.com/cdn/shop/files/PRIME_hydration_1serve_16.9oz_US_RedChill_00000-2_3_2000x.png?v=1735831398',price: 2000, unlocked: false },
                { id: 19, name: 'Blue Chill', image: 'https://drinkprime.com/cdn/shop/files/PrimeHydration_US_1serve_16oz_ICE_Blue_00000_2_2000x.png?v=1735830966', price: 3000, unlocked: false },
                { id: 20, name: 'KSI Nightmare', image: 'https://drinkprime.com/cdn/shop/files/PRIME_Hydration_US_1serve_16.9oz_Niagara_KSI_Nightmare_0000_1_10239ca5-2c36-4586-8c44-f23d0d824553_1200x.png?v=1755007066', price: 350, unlocked: false },
                { id: 21, name: 'IShowSpeed', image: 'https://drinkprime.com/cdn/shop/files/Speed-Bottle-Front_b2fe6348-b16b-4582-b0fb-c2f3efcc2bc5_2000x.png?v=1727210047', price: 4000, unlocked: false },
                { id: 22, name: 'Original', image: 'https://drinkprime.com/cdn/shop/files/PE-Original_V2_2000x.png?v=1738170791', price: 5000, unlocked: false }  
            ];

            const difficulties = { easy: [{ level: 1, slots: 2 }, { level: 2, slots: 3 }, { level: 3, slots: 4 }], medium: [{ level: 1, slots: 5 }, { level: 2, slots: 6 }, { level: 3, slots: 7 }], hard: [{ level: 1, slots: 8 }, { level: 2, slots: 9 }, { level: 3, slots: 9 }] };
            let gameState = { coins: 100, unlockedBottles: [1, 2, 5, 14, 15], completedLevels: [], currentDifficulty: 'easy', currentLevel: 1, targetSequence: [], currentAttempt: [], moves: 0, isSwapMode: false, firstSelectedBottle: null, timer: 0, timerInterval: null, settings: { darkMode: false, soundEffects: true, music: true } };

            // DOM elements
            const coinsDisplay = document.getElementById('coins');
            const levelDisplay = document.querySelector('.level-display');
            const playBtn = document.getElementById('play-btn');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const soundToggle = document.getElementById('sound-toggle');
            const musicToggle = document.getElementById('music-toggle');
            const resetGameBtn = document.getElementById('reset-game-btn');
            const startBtn = document.getElementById('start-btn');
            const checkBtn = document.getElementById('check-btn');
            const newGameBtn = document.getElementById('new-game-btn');
            const navBar = document.getElementById('nav-bar');
            const searchInput = document.getElementById('search-input');
            const collectionBtn = document.getElementById('collection-btn');
            const searchResults = document.getElementById('search-results');
            const shopItems = document.getElementById('shop-items');

            // Audio setup
            const audio = { synth: new Tone.Synth().toDestination(), music: new Tone.Player({ url: "https://cdn.jsdelivr.net/gh/devoss/pomodoro/src/assets/audio/alarm.mp3", loop: true, volume: -12, }).toDestination() };
            function playSound(type) { if (!gameState.settings.soundEffects) return; try { switch (type) { case 'click': audio.synth.triggerAttackRelease("C4", "8n"); break; case 'place': audio.synth.triggerAttackRelease("E4", "8n"); break; case 'swap': audio.synth.triggerAttackRelease("G4", "8n"); break; case 'success': audio.synth.triggerAttackRelease(["C5", "E5", "G5"], "8n"); break; case 'error': audio.synth.triggerAttackRelease("C3", "8n"); break; case 'unlock': audio.synth.triggerAttackRelease(["C4", "E4", "G4", "C5"], "4n"); break; } } catch (e) { console.error("Tone.js error:", e); } }
            function toggleMusicPlayback() { if (gameState.settings.music && Tone.context.state === 'running') { if (audio.music.state !== 'started') audio.music.start(); } else { audio.music.stop(); } }
            
            // Navigation
            function navigateTo(pageId) {
                playSound('click');
                document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                document.getElementById(pageId).classList.add('active');
                
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                const activeNavItem = document.querySelector(`.nav-item[data-page="${pageId}"]`);
                if(activeNavItem) activeNavItem.classList.add('active');

                if (pageId === 'shop-page') {
                    showShop();
                    searchInput.value = '';
                    searchResults.classList.add('hidden');
                    collectionBtn.classList.remove('active');
                }
                if (pageId === 'settings-page') showSettings();
            }

            // Event Listeners
            function setupEventListeners() {
                playBtn.addEventListener('click', startGame);
                navBar.addEventListener('click', (e) => {
                    const navItem = e.target.closest('.nav-item');
                    if(navItem) navigateTo(navItem.dataset.page);
                });
                darkModeToggle.addEventListener('change', toggleDarkMode);
                soundToggle.addEventListener('change', () => gameState.settings.soundEffects = soundToggle.checked);
                musicToggle.addEventListener('change', () => { gameState.settings.music = musicToggle.checked; toggleMusicPlayback(); });
                resetGameBtn.addEventListener('click', resetGameProgress);
                document.getElementById('difficulty-select').addEventListener('change', changeDifficulty);
                document.getElementById('level-select').addEventListener('change', changeLevel);
                checkBtn.addEventListener('click', checkSequence);
                startBtn.addEventListener('click', startSwapMode);
                newGameBtn.addEventListener('click', resetLevel);
                
                // Search functionality
                searchInput.addEventListener('input', performSearch);
                
                // Collection button
                collectionBtn.addEventListener('click', toggleCollectionView);
            }

            async function startGame() {
                if (Tone.context.state !== 'running') await Tone.start();
                toggleMusicPlayback();
                navBar.classList.remove('hidden');
                navigateTo('game-page');
                loadLevel();
            }

            // Search functionality
            function performSearch() {
                const query = searchInput.value.toLowerCase().trim();
                
                if (query === '') {
                    searchResults.classList.add('hidden');
                    shopItems.classList.remove('hidden');
                    return;
                }
                
                const results = allBottles.filter(bottle => 
                    bottle.name.toLowerCase().includes(query)
                );
                
                displaySearchResults(results);
            }
            
            function displaySearchResults(results) {
                searchResults.innerHTML = '';
                
                if (results.length === 0) {
                    searchResults.innerHTML = '<div class="search-result-item">No results found</div>';
                } else {
                    results.forEach(bottle => {
                        const isUnlocked = gameState.unlockedBottles.includes(bottle.id);
                        
                        const resultItem = document.createElement('div');
                        resultItem.className = `search-result-item ${isUnlocked ? 'owned' : ''}`;
                        
                        resultItem.innerHTML = `
                            <img src="${bottle.image}" alt="${bottle.name}">
                            <div class="search-result-info">
                                <div class="search-result-name">${bottle.name}</div>
                                <div class="search-result-status">
                                    ${isUnlocked ? 'OWNED' : `ðŸª™ ${bottle.price}`}
                                </div>
                            </div>
                            ${isUnlocked ? 
                                `<button class="search-result-select-btn" data-id="${bottle.id}">
                                    OWNED
                                </button>` : 
                                `<button class="search-result-select-btn" data-id="${bottle.id}" onclick="purchaseBottleFromSearch(${bottle.id})">
                                    BUY
                                </button>`
                            }
                        `;
                        
                        searchResults.appendChild(resultItem);
                    });
                }
                
                searchResults.classList.remove('hidden');
                shopItems.classList.add('hidden');
            }
            
            function purchaseBottleFromSearch(bottleId) {
                const bottle = allBottles.find(b => b.id === bottleId);
                if (bottle) {
                    purchaseBottle(bottle);
                    // Refresh search results after purchase
                    setTimeout(performSearch, 100);
                }
            }
            
            function toggleCollectionView() {
                playSound('click');
                if (collectionBtn.classList.contains('active')) {
                    // Show all bottles
                    collectionBtn.classList.remove('active');
                    showShop();
                    searchInput.value = '';
                    searchResults.classList.add('hidden');
                } else {
                    // Show only unlocked bottles
                    collectionBtn.classList.add('active');
                    showShop(bottle => gameState.unlockedBottles.includes(bottle.id));
                    searchInput.value = '';
                    searchResults.classList.add('hidden');
                }
            }

            function loadLevel() {
                const level = getCurrentLevel();
                gameState.targetSequence = [];
                gameState.currentAttempt = new Array(level.slots).fill(null);
                gameState.moves = 0;
                gameState.isSwapMode = false;
                gameState.firstSelectedBottle = null;
                clearInterval(gameState.timerInterval);
                gameState.timer = 0;
                gameState.timerInterval = null;

                const availableBottles = allBottles.filter(b => gameState.unlockedBottles.includes(b.id));
                if (availableBottles.length < level.slots) {
                    showMessage(`Unlock more bottles to play this level!`, "error");
                    return;
                }
                const shuffledBottles = [...availableBottles].sort(() => 0.5 - Math.random());
                gameState.targetSequence = shuffledBottles.slice(0, level.slots);
                setupBoard(level.slots);
                updateUI();
            }

            function setupBoard(slotsCount) {
                const playerSequence = document.getElementById('player-sequence');
                playerSequence.innerHTML = '';
                for (let i = 0; i < slotsCount; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'slot';
                    slot.dataset.position = i;
                    slot.innerHTML = `<div class="slot-label">${i + 1}</div>`;
                    slot.addEventListener('click', () => handleSlotClick(slot, i));
                    playerSequence.appendChild(slot);
                }
                const bottleOptions = document.getElementById('bottle-options');
                bottleOptions.innerHTML = '';
                const displayBottles = [...gameState.targetSequence].sort(() => 0.5 - Math.random());
                displayBottles.forEach(bottle => {
                    const bottleEl = document.createElement('img');
                    bottleEl.src = bottle.image;
                    bottleEl.className = 'bottle-option';
                    bottleEl.dataset.id = bottle.id;
                    bottleEl.addEventListener('click', () => handleBottleOptionClick(bottle));
                    bottleOptions.appendChild(bottleEl);
                });
            }

            function handleSlotClick(slot, position) { playSound('click'); if (gameState.isSwapMode) { if (gameState.firstSelectedBottle === null) selectFirstBottleForSwap(slot, position); else selectSecondBottleForSwap(slot, position); } else { document.querySelectorAll('.slot.selected').forEach(s => s.classList.remove('selected')); slot.classList.add('selected'); } }
            function handleBottleOptionClick(bottle) { const selectedSlot = document.querySelector('.slot.selected'); if (selectedSlot && !gameState.isSwapMode) placeBottleInSlot(bottle, parseInt(selectedSlot.dataset.position)); else if (gameState.isSwapMode) showMessage("You are in swap mode. Click bottles on the shelf to swap.", "warning"); else showMessage("Please select a slot first!", "error"); }
            function placeBottleInSlot(bottle, slotPosition) { const slot = document.querySelector(`.slot[data-position="${slotPosition}"]`); const existingBottleEl = slot.querySelector('.bottle'); if (existingBottleEl) existingBottleEl.remove(); const newBottle = document.createElement('img'); newBottle.src = bottle.image; newBottle.className = 'bottle'; slot.appendChild(newBottle); gameState.currentAttempt[slotPosition] = bottle.id; slot.classList.remove('selected');
                if (!gameState.timerInterval) {
                    gameState.timerInterval = setInterval(updateTimer, 1000);
                }
                playSound('place'); gameState.moves++; updateUI();
            }
            function startSwapMode() { if (gameState.currentAttempt.includes(null)) { showMessage("Please fill all slots before starting!", "error"); playSound('error'); return; } playSound('click'); gameState.isSwapMode = true; showMessage("Swap mode activated! Click two bottles to swap.", "warning"); updateUI(); }
            function selectFirstBottleForSwap(slot, position) { if (!gameState.currentAttempt[position]) { showMessage("This slot is empty!", "error"); return; } document.querySelectorAll('.slot.selected').forEach(s => s.classList.remove('selected')); slot.classList.add('selected'); gameState.firstSelectedBottle = position; }
            function selectSecondBottleForSwap(slot, position) { if (!gameState.currentAttempt[position] || position === gameState.firstSelectedBottle) return; swapBottles(gameState.firstSelectedBottle, position); document.querySelectorAll('.slot.selected').forEach(s => s.classList.remove('selected')); gameState.firstSelectedBottle = null; gameState.moves++; updateUI(); playSound('swap'); }
            function swapBottles(pos1, pos2) { [gameState.currentAttempt[pos1], gameState.currentAttempt[pos2]] = [gameState.currentAttempt[pos2], gameState.currentAttempt[pos1]]; const slot1 = document.querySelector(`.slot[data-position="${pos1}"]`), slot2 = document.querySelector(`.slot[data-position="${pos2}"]`); const bottle1 = slot1.querySelector('.bottle'), bottle2 = slot2.querySelector('.bottle'); if (bottle1) slot2.appendChild(bottle1); if (bottle2) slot1.appendChild(bottle2); }
            
            function checkSequence() {
                playSound('click');
                clearInterval(gameState.timerInterval);
                const level = getCurrentLevel();
                let correctPositions = 0;

                for (let i = 0; i < gameState.currentAttempt.length; i++) {
                    if (gameState.currentAttempt[i] === gameState.targetSequence[i].id) {
                        correctPositions++;
                    }
                }
                
                if (correctPositions === level.slots) {
                    const timeScore = Math.max(0, 100 - gameState.timer);
                    const movesScore = Math.max(0, 100 - (gameState.moves - level.slots) * 2);
                    const score = Math.floor((timeScore + movesScore) / 2) + level.slots * 10;
                    addCoins(score);
                    showMessage(`Perfect! You earned ${score} coins!`, 'success');
                    animateCelebration();
                    playSound('success');
                    if (gameState.moves <= level.slots) unlockCheapestBottle();
                    checkBtn.disabled = true;
                } else {
                    showMessage(`${correctPositions} of ${level.slots} correct. Try again!`, 'error');
                    playSound('error');
                    gameState.timerInterval = setInterval(updateTimer, 1000);
                }
            }

            function updateUI() {
                coinsDisplay.textContent = gameState.coins;
                levelDisplay.textContent = `${gameState.currentDifficulty} ${gameState.currentLevel}`;
                document.getElementById('level-number').textContent = gameState.currentLevel;
                document.getElementById('moves').textContent = gameState.moves;
                startBtn.classList.toggle('hidden', gameState.isSwapMode);
                checkBtn.classList.toggle('hidden', !gameState.isSwapMode);
                startBtn.disabled = gameState.currentAttempt.includes(null);
                checkBtn.disabled = false;
                document.getElementById('difficulty-select').value = gameState.currentDifficulty;
                const levelSelect = document.getElementById('level-select'); levelSelect.innerHTML = ''; difficulties[gameState.currentDifficulty].forEach(lvl => { const option = document.createElement('option'); option.value = lvl.level; option.textContent = `${lvl.level}`; levelSelect.appendChild(option); }); levelSelect.value = gameState.currentLevel;
            }

            function updateTimer() { gameState.timer++; const minutes = Math.floor(gameState.timer / 60).toString().padStart(2, '0'); const seconds = (gameState.timer % 60).toString().padStart(2, '0'); document.getElementById('timer').textContent = `${minutes}:${seconds}`; }
            function showMessage(message, type = 'info') { const feedbackEl = document.getElementById('feedback'); feedbackEl.textContent = message; feedbackEl.className = `feedback ${type}`; }
            
            function showShop(filterFunc = null) { 
                const shopItemsContainer = document.getElementById('shop-items'); 
                shopItemsContainer.innerHTML = ''; 
                let bottlesToShow = allBottles;
                
                if (filterFunc) {
                    bottlesToShow = allBottles.filter(filterFunc);
                }
                
                bottlesToShow.forEach(bottle => { 
                    const isUnlocked = gameState.unlockedBottles.includes(bottle.id); 
                    const item = document.createElement('div'); 
                    item.className = `shop-item ${isUnlocked ? 'unlocked' : 'locked'}`; 
                    item.innerHTML = `<img src="${bottle.image}" alt="${bottle.name}"><h3>${bottle.name}</h3><div class="shop-item-price">${isUnlocked ? 'OWNED' : `ðŸª™ ${bottle.price}`}</div>`; 
                    if (!isUnlocked) item.addEventListener('click', () => purchaseBottle(bottle)); 
                    shopItemsContainer.appendChild(item); 
                }); 
            }
            
            function purchaseBottle(bottle) { 
                if (gameState.coins >= bottle.price) { 
                    gameState.coins -= bottle.price; 
                    gameState.unlockedBottles.push(bottle.id); 
                    playSound('unlock'); 
                    saveGameProgress(); 
                    showShop(); 
                    showMessage(`Unlocked ${bottle.name}!`, 'unlock'); 
                } else { 
                    playSound('error'); 
                    showMessage(`You need ${bottle.price - gameState.coins} more coins!`, 'error'); 
                } 
            }
            
            function showSettings() { darkModeToggle.checked = gameState.settings.darkMode; soundToggle.checked = gameState.settings.soundEffects; musicToggle.checked = gameState.settings.music; }
            function toggleDarkMode() { playSound('click'); gameState.settings.darkMode = darkModeToggle.checked; document.body.classList.toggle('dark-mode', gameState.settings.darkMode); saveGameProgress(); }
            function resetGameProgress() { playSound('click'); if (confirm("Reset all game progress?")) { localStorage.removeItem('primeBottleMasterProgress'); gameState = { coins: 100, unlockedBottles: [1, 2, 5, 14, 15], completedLevels: [], currentDifficulty: 'easy', currentLevel: 1, targetSequence: [], currentAttempt: [], moves: 0, isSwapMode: false, firstSelectedBottle: null, timer: 0, timerInterval: null, settings: gameState.settings }; navigateTo('game-page'); showMessage("Game progress reset.", "success"); loadLevel(); } }
            
            function changeDifficulty(e) { playSound('click'); gameState.currentDifficulty = e.target.value; gameState.currentLevel = 1; loadLevel(); }
            function changeLevel(e) { playSound('click'); gameState.currentLevel = parseInt(e.target.value); loadLevel(); }
            function resetLevel() { playSound('click'); loadLevel(); }
            function addCoins(amount) { gameState.coins += amount; saveGameProgress(); }
            function unlockCheapestBottle() {
                const levelId = `${gameState.currentDifficulty}-${gameState.currentLevel}`;
                if (gameState.completedLevels.includes(levelId)) {
                    return; // Reward already claimed for this level
                }

                const lockedBottles = allBottles.filter(b => !gameState.unlockedBottles.includes(b.id));
                if (lockedBottles.length > 0) {
                    lockedBottles.sort((a, b) => a.price - b.price);
                    const cheapestBottle = lockedBottles[0];
                    gameState.unlockedBottles.push(cheapestBottle.id);
                    gameState.completedLevels.push(levelId);
                    showMessage(`BONUS: Unlocked ${cheapestBottle.name}!`, 'unlock');
                    playSound('unlock');
                    saveGameProgress();
                }
            }
            function animateCelebration() { const gameBoard = document.querySelector('.game-board'); for (let i = 0; i < 50; i++) { setTimeout(() => { const confetti = document.createElement('div'); confetti.className = 'confetti'; confetti.style.left = `${Math.random() * 100}%`; confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`; confetti.style.animationDuration = `${Math.random() * 2 + 3}s`; gameBoard.appendChild(confetti); setTimeout(() => confetti.remove(), 5000); }, i * 30); } }
            function saveGameProgress() { localStorage.setItem('primeBottleMasterProgress', JSON.stringify({ coins: gameState.coins, unlockedBottles: gameState.unlockedBottles, completedLevels: gameState.completedLevels, currentDifficulty: gameState.currentDifficulty, currentLevel: gameState.currentLevel, settings: gameState.settings })); updateUI(); }
            function loadGameProgress() { const saved = localStorage.getItem('primeBottleMasterProgress'); if (saved) { const progress = JSON.parse(saved); gameState.coins = progress.coins || 100; gameState.unlockedBottles = progress.unlockedBottles || [1, 2, 5, 14, 15]; gameState.completedLevels = progress.completedLevels || []; gameState.currentDifficulty = progress.currentDifficulty || 'easy'; gameState.currentLevel = progress.currentLevel || 1; gameState.settings = progress.settings || { darkMode: false, soundEffects: true, music: true }; } document.body.classList.toggle('dark-mode', gameState.settings.darkMode); }
            function getCurrentLevel() { return difficulties[gameState.currentDifficulty].find(l => l.level === gameState.currentLevel); }
            
            // Initialize
            function init() {
                loadGameProgress();
                setupEventListeners();
                updateUI();
                navigateTo('welcome-page');
                
                // Make purchaseBottleFromSearch available globally
                window.purchaseBottleFromSearch = purchaseBottleFromSearch;
            }
            init();
        });
    </script>
</body>
</html>